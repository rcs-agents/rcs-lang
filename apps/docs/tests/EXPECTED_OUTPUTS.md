# Expected Test Outputs

This document shows what each test expects to see when the playground is working correctly.

## Test Input: Default "Hello World" Example

```rcl
agent HelloWorld {
  config {
    name: "Hello World Bot"
  }

  messages {
    welcome: "Hello! ðŸ‘‹"
    goodbye: "Goodbye!"
  }

  flow MainFlow {
    on start {
      send(@welcome)
      match {
        * -> end
      }
    }
  }
}
```

---

## Expected AST Output

```json
{
  "type": "RclFile",
  "imports": [],
  "agent": {
    "type": "Agent",
    "name": {
      "type": "Identifier",
      "value": "HelloWorld"
    },
    "sections": [
      {
        "type": "Section",
        "sectionType": "config",
        "body": [
          {
            "type": "Attribute",
            "key": "name",
            "value": {
              "type": "StringLiteral",
              "value": "Hello World Bot"
            }
          }
        ]
      },
      {
        "type": "Section",
        "sectionType": "messages",
        "body": [
          {
            "type": "Attribute",
            "key": "welcome",
            "value": {
              "type": "StringLiteral",
              "value": "Hello! ðŸ‘‹"
            }
          },
          {
            "type": "Attribute",
            "key": "goodbye",
            "value": {
              "type": "StringLiteral",
              "value": "Goodbye!"
            }
          }
        ]
      },
      {
        "type": "Section",
        "sectionType": "flow",
        "name": "MainFlow",
        "body": [
          {
            "type": "StateHandler",
            "state": "start",
            "body": [
              {
                "type": "SendAction",
                "message": {
                  "type": "Variable",
                  "name": "welcome"
                }
              },
              {
                "type": "Match",
                "cases": [
                  {
                    "pattern": "*",
                    "target": "end"
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}
```

**Test Assertions:**
- âœ… Contains `"type": "RclFile"`
- âœ… Contains `"type": "Agent"`
- âœ… Contains `"type": "Section"`
- âœ… Length > 50 characters
- âœ… No error messages

---

## Expected RBX JSON Output

```json
{
  "messages": [
    {
      "contentMessage": {
        "text": "Hello! ðŸ‘‹",
        "suggestions": []
      }
    }
  ],
  "richCard": null,
  "suggestions": [
    {
      "action": {
        "text": "Continue",
        "postbackData": "*"
      }
    }
  ]
}
```

**Test Assertions:**
- âœ… Contains `"messages"` property
- âœ… Contains JSON braces `{}`
- âœ… Has syntax highlighting (`.shiki` class)
- âœ… Length > 50 characters
- âœ… No placeholder text
- âœ… Contains RCS Business Messaging properties

---

## Expected JavaScript Output

```javascript
// Generated by @rcs-lang/compiler
export class HelloWorldAgent {
  constructor() {
    this.state = 'start';
    this.context = {};
    this.messages = {
      welcome: "Hello! ðŸ‘‹",
      goodbye: "Goodbye!"
    };
  }

  handleMessage(userInput) {
    const currentState = this.state;

    if (currentState === 'start') {
      return {
        message: this.messages.welcome,
        suggestions: [
          { text: 'Continue', postbackData: '*' }
        ],
        nextState: 'end'
      };
    }

    if (currentState === 'end') {
      return { terminate: true };
    }
  }

  reset() {
    this.state = 'start';
    this.context = {};
  }
}
```

**Test Assertions:**
- âœ… Contains `function`, `const`, `class`, or `export`
- âœ… Contains `state`, `handler`, or `transition`
- âœ… Has syntax highlighting
- âœ… Length > 50 characters
- âœ… No placeholder text

---

## Expected Diagram Output (Sprotty SVG)

For the "Sub-flow Invocation" example:

```xml
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <!-- Start node -->
  <g class="sprotty-node" data-kind="state">
    <rect x="100" y="50" width="120" height="60" rx="5" class="state-node"/>
    <text x="160" y="85" text-anchor="middle">start</text>
  </g>

  <!-- Processing node -->
  <g class="sprotty-node" data-kind="state">
    <rect x="100" y="200" width="120" height="60" rx="5" class="state-node"/>
    <text x="160" y="235" text-anchor="middle">processing</text>
  </g>

  <!-- End node -->
  <g class="sprotty-node" data-kind="state">
    <rect x="100" y="350" width="120" height="60" rx="5" class="state-node"/>
    <text x="160" y="385" text-anchor="middle">end</text>
  </g>

  <!-- Edge: start -> processing -->
  <g class="sprotty-edge">
    <path d="M160,110 L160,200" class="edge-path" marker-end="url(#arrow)"/>
    <text x="170" y="155" class="edge-label">*</text>
  </g>

  <!-- Edge: processing -> end -->
  <g class="sprotty-edge">
    <path d="M160,260 L160,350" class="edge-path" marker-end="url(#arrow)"/>
    <text x="170" y="305" class="edge-label">done</text>
  </g>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="5" refY="5">
      <polygon points="0,0 10,5 0,10" fill="currentColor"/>
    </marker>
  </defs>
</svg>
```

**Test Assertions:**
- âœ… SVG element exists
- âœ… Contains graph primitives: `rect`, `circle`, `path`, `line`
- âœ… SVG content length > 100 characters
- âœ… No error message "Error rendering diagram"
- âœ… No message "No flows found"

---

## Expected Errors Output (for invalid code)

**Input:** `agent InvalidAgent {`

**Expected Error:**

```
âŒ Parse Error
Line 1, Column 21
Expected '}' to close agent block

agent InvalidAgent {
                    ^
```

**Test Assertions:**
- âœ… Error items are visible
- âœ… Error text length > 10 characters
- âœ… Contains keywords: `error`, `expected`, `syntax`
- âœ… Does NOT contain module externalization error

---

## Expected Status Bar

```
Parse: 15ms | 0 errors | Line 1, Col 1
```

**Test Assertions:**
- âœ… Shows parse time matching `/\d+\s*ms/`
- âœ… Shows cursor position matching `/Line.*Col/i`
- âœ… Parse time is reasonable (< 1000ms)

---

## Expected Console Output

**When working correctly:**

```
âœ… No errors
```

**Currently (failing state):**

```
âŒ Error: Module "node:fs" has been externalized for browser compatibility.
Cannot access "node:fs.constants" in client code.
See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility
```

**Test Assertions:**
- âœ… No console errors
- âœ… Specifically: no errors containing "Module" and "externalized"

---

## Expected URL Hash

**After clicking Share button:**

```
https://rcl.rcsagents.io/playground#N4IgdghgtgpiBcIQBoQDcA2BrEAuEAzAAgCUBPMEARgA4CA6AYwLSwDssACAHQA5ABWiSwAzADYAjNAAdxIwmxEjRU7o0FAA
```

**Decoded content:**
```rcl
agent TestAgent {
  config {
    name: "Test"
  }
}
```

**Test Assertions:**
- âœ… URL contains `#` hash
- âœ… Hash decodes to original source code
- âœ… Loading URL restores code in editor
- âœ… Loading URL triggers compilation
- âœ… All output tabs have content

---

## Test Success Checklist

When all tests pass, you should be able to:

1. **Open `/playground`** â†’ See Monaco editor with example code
2. **Click AST tab** â†’ See parsed AST structure
3. **Click Errors tab** â†’ See "No errors" (or syntax errors for invalid code)
4. **Click Diagram tab** â†’ See interactive SVG with state nodes and edges
5. **Click RBX JSON tab** â†’ See compiled Google RCS Business Messaging JSON
6. **Click JavaScript tab** â†’ See compiled CSM runtime code
7. **Type code** â†’ All tabs update within 1 second
8. **Load example** â†’ All tabs update with example's compiled output
9. **Click Share** â†’ URL hash updates
10. **Open shared URL** â†’ Code and output restore correctly
11. **Check console** â†’ No errors

All tabs should have:
- âœ… Real content (not placeholders)
- âœ… Syntax highlighting (Shiki for JSON/JS)
- âœ… Copy buttons working
- âœ… No error messages about module externalization
