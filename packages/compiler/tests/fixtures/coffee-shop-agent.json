{
  "agent": {
    "name": "CoffeeShop",
    "displayName": "Quick Coffee",
    "config": {
      "description": "Order your favorite coffee for pickup",
      "logoUri": "https://quickcoffee.com/logo.png",
      "color": "#6F4E37",
      "phoneNumber": "+1-555-0123",
      "phoneLabel": "Call Store"
    },
    "defaults": {
      "fallbackMessage": "I didn't understand that. Please choose from the available options.",
      "messageTrafficType": "PROMOTION",
      "postbackData": "{{ suggestion.text | lower | replace(' ', '_') | replace(/[^a-z0-9_]/g, '') }}"
    }
  },
  "csm": {
    "id": "CoffeeShop",
    "initialFlow": "TopFlow",
    "flows": {
      "TopFlow": {
        "id": "TopFlow",
        "initial": "Welcome",
        "states": {
          "Welcome": {
            "transitions": [
              {
                "pattern": "Start Order",
                "target": "state:ConfirmAllOrders",
                "flowInvocation": {
                  "flowId": "CreateOrder",
                  "parameters": {},
                  "onResult": {
                    "end": {
                      "operations": [
                        {
                          "append": {
                            "to": "orders",
                            "value": {"var": "result"}
                          }
                        }
                      ],
                      "target": "state:ConfirmAllOrders"
                    },
                    "cancel": {
                      "target": "state:Welcome"
                    },
                    "error": {
                      "target": "state:OrderError"
                    }
                  }
                }
              },
              {
                "pattern": "View Menu",
                "target": "state:ShowMenu"
              },
              {
                "pattern": "Store Hours",
                "target": "state:StoreInfo"
              },
              {
                "pattern": ":default",
                "target": "state:Welcome"
              }
            ],
            "meta": {
              "messageId": "Welcome"
            }
          },
          "ShowMenu": {
            "transitions": [
              {
                "pattern": "Start Order",
                "target": "state:ConfirmAllOrders",
                "flowInvocation": {
                  "flowId": "CreateOrder",
                  "parameters": {},
                  "onResult": {
                    "end": {
                      "operations": [
                        {
                          "append": {
                            "to": "orders",
                            "value": {"var": "result"}
                          }
                        }
                      ],
                      "target": "state:ConfirmAllOrders"
                    },
                    "cancel": {
                      "target": "state:Welcome"
                    },
                    "error": {
                      "target": "state:OrderError"
                    }
                  }
                }
              },
              {
                "pattern": "Back",
                "target": "state:Welcome"
              }
            ],
            "meta": {
              "messageId": "ShowMenu",
              "transient": true
            }
          },
          "StoreInfo": {
            "transitions": [
              {
                "pattern": "Start Order",
                "target": "state:ConfirmAllOrders",
                "flowInvocation": {
                  "flowId": "CreateOrder",
                  "parameters": {},
                  "onResult": {
                    "end": {
                      "operations": [
                        {
                          "append": {
                            "to": "orders",
                            "value": {"var": "result"}
                          }
                        }
                      ],
                      "target": "state:ConfirmAllOrders"
                    },
                    "cancel": {
                      "target": "state:Welcome"
                    },
                    "error": {
                      "target": "state:OrderError"
                    }
                  }
                }
              },
              {
                "pattern": "Back",
                "target": "state:Welcome"
              }
            ],
            "meta": {
              "messageId": "StoreInfo",
              "transient": true
            }
          },
          "OrderError": {
            "transitions": [
              {
                "pattern": "Try Again",
                "target": "state:Welcome"
              },
              {
                "pattern": "Contact Support",
                "target": "state:ShowSupport"
              }
            ],
            "meta": {
              "messageId": "OrderError"
            }
          },
          "ShowSupport": {
            "transitions": [
              {
                "pattern": "Back",
                "target": "state:Welcome"
              }
            ],
            "meta": {
              "messageId": "ShowSupport"
            }
          },
          "ConfirmAllOrders": {
            "transitions": [
              {
                "pattern": "Add Another Order",
                "target": "state:ConfirmAllOrders",
                "flowInvocation": {
                  "flowId": "CreateOrder",
                  "parameters": {},
                  "onResult": {
                    "end": {
                      "operations": [
                        {
                          "append": {
                            "to": "orders",
                            "value": {"var": "result"}
                          }
                        }
                      ],
                      "target": "state:ConfirmAllOrders"
                    },
                    "cancel": {
                      "target": "state:ConfirmAllOrders"
                    },
                    "error": {
                      "target": "state:OrderError"
                    }
                  }
                }
              },
              {
                "pattern": "Confirm All Orders",
                "target": "state:ProcessPayment"
              },
              {
                "pattern": "Cancel All Orders",
                "target": "state:Welcome",
                "context": {
                  "orders": []
                }
              }
            ],
            "meta": {
              "messageId": "ConfirmAllOrders"
            }
          },
          "ProcessPayment": {
            "transitions": [
              {
                "target": "state:OrderComplete"
              }
            ],
            "meta": {
              "messageId": "ProcessPayment",
              "transient": true
            }
          },
          "OrderComplete": {
            "transitions": [
              {
                "target": "state:ThankYou"
              }
            ],
            "meta": {
              "messageId": "OrderComplete",
              "transient": true
            }
          },
          "ThankYou": {
            "transitions": [
              {
                "pattern": "Start New Order",
                "target": "state:Welcome",
                "context": {
                  "orders": []
                }
              },
              {
                "pattern": "View Receipt",
                "target": "state:ShowReceipt"
              }
            ],
            "meta": {
              "messageId": "ThankYou"
            }
          },
          "ShowReceipt": {
            "transitions": [
              {
                "pattern": "Start New Order",
                "target": "state:Welcome",
                "context": {
                  "orders": []
                }
              },
              {
                "pattern": "Back",
                "target": "state:Welcome"
              }
            ],
            "meta": {
              "messageId": "ShowReceipt"
            }
          }
        },
        "meta": {
          "name": "Coffee Shop Top Flow",
          "description": "Main conversation flow for coffee shop agent",
          "version": "1.0.0"
        }
      },
      "CreateOrder": {
        "id": "CreateOrder",
        "initial": "Menu",
        "states": {
          "Menu": {
            "transitions": [
              {
                "pattern": "Order Coffee",
                "target": "state:Menu",
                "flowInvocation": {
                  "flowId": "OrderCoffee",
                  "parameters": {},
                  "onResult": {
                    "end": {
                      "operations": [
                        {
                          "append": {
                            "to": "orderItems",
                            "value": {"var": "result"}
                          }
                        }
                      ],
                      "target": "state:Menu"
                    },
                    "cancel": {
                      "target": "state:Menu"
                    },
                    "error": {
                      "target": "state:Menu"
                    }
                  }
                }
              },
              {
                "pattern": "Review Order",
                "target": "state:ReviewOrder"
              },
              {
                "pattern": "Cancel Order",
                "target": ":cancel"
              }
            ],
            "meta": {
              "messageId": "Menu"
            }
          },
          "ReviewOrder": {
            "transitions": [
              {
                "pattern": "Add Another Coffee",
                "target": "state:ReviewOrder",
                "flowInvocation": {
                  "flowId": "OrderCoffee",
                  "parameters": {},
                  "onResult": {
                    "end": {
                      "operations": [
                        {
                          "append": {
                            "to": "orderItems",
                            "value": {"var": "result"}
                          }
                        }
                      ],
                      "target": "state:ReviewOrder"
                    },
                    "cancel": {
                      "target": "state:ReviewOrder"
                    },
                    "error": {
                      "target": "state:ReviewOrder"
                    }
                  }
                }
              },
              {
                "pattern": "Remove Last Item",
                "target": "state:RemoveItem"
              },
              {
                "pattern": "Confirm Order",
                "target": "state:ConfirmOrder"
              },
              {
                "pattern": "Cancel Order",
                "target": ":cancel"
              }
            ],
            "meta": {
              "messageId": "ReviewOrder"
            }
          },
          "RemoveItem": {
            "transitions": [
              {
                "target": "state:ReviewOrder",
                "context": {
                  "orderItems": {"slice": [{"var": "orderItems"}, 0, -1]}
                }
              }
            ],
            "meta": {
              "transient": true
            }
          },
          "ConfirmOrder": {
            "transitions": [
              {
                "pattern": "Yes, Confirm",
                "target": ":end"
              },
              {
                "pattern": "No, Go Back",
                "target": "state:ReviewOrder"
              },
              {
                "pattern": "Cancel Order",
                "target": ":cancel"
              }
            ],
            "meta": {
              "messageId": "ConfirmOrder"
            }
          }
        },
        "meta": {
          "name": "Create Order Flow",
          "description": "Flow for creating a single order with multiple items",
          "version": "1.0.0"
        }
      },
      "OrderCoffee": {
        "id": "OrderCoffee",
        "initial": "ChooseDrink",
        "states": {
          "ChooseDrink": {
            "transitions": [
              {
                "pattern": "Espresso",
                "target": "state:Customize",
                "context": {
                  "drink": "espresso"
                }
              },
              {
                "pattern": "Cappuccino",
                "target": "state:Customize",
                "context": {
                  "drink": "cappuccino"
                }
              },
              {
                "pattern": "Latte",
                "target": "state:Customize",
                "context": {
                  "drink": "latte"
                }
              },
              {
                "pattern": "Americano",
                "target": "state:Customize",
                "context": {
                  "drink": "americano"
                }
              },
              {
                "pattern": ":default",
                "target": "state:InvalidDrink"
              }
            ],
            "meta": {
              "messageId": "ChooseDrink"
            }
          },
          "InvalidDrink": {
            "transitions": [
              {
                "target": "state:ChooseDrink"
              }
            ],
            "meta": {
              "messageId": "InvalidDrink",
              "transient": true
            }
          },
          "Customize": {
            "transitions": [
              {
                "pattern": "Regular",
                "target": "state:ChooseSize",
                "context": {
                  "milk": "regular"
                }
              },
              {
                "pattern": "Skim",
                "target": "state:ChooseSize",
                "context": {
                  "milk": "skim"
                }
              },
              {
                "pattern": "Soy",
                "target": "state:ChooseSize",
                "context": {
                  "milk": "soy",
                  "extraCharge": 0.60
                }
              },
              {
                "pattern": "Oat",
                "target": "state:ChooseSize",
                "context": {
                  "milk": "oat",
                  "extraCharge": 0.60
                }
              },
              {
                "pattern": "No Milk",
                "target": "state:ChooseSize",
                "context": {
                  "milk": "none"
                }
              },
              {
                "pattern": ":default",
                "target": "state:InvalidMilk"
              }
            ],
            "meta": {
              "messageId": "Customize"
            }
          },
          "InvalidMilk": {
            "transitions": [
              {
                "target": "state:Customize"
              }
            ],
            "meta": {
              "messageId": "InvalidMilk",
              "transient": true
            }
          },
          "ChooseSize": {
            "transitions": [
              {
                "pattern": "Small",
                "target": ":end",
                "context": {
                  "size": "small",
                  "price": 3.50
                }
              },
              {
                "pattern": "Medium",
                "target": ":end",
                "context": {
                  "size": "medium",
                  "price": 4.50
                }
              },
              {
                "pattern": "Large",
                "target": ":end",
                "context": {
                  "size": "large",
                  "price": 5.50
                }
              },
              {
                "pattern": ":default",
                "target": "state:InvalidSize"
              }
            ],
            "meta": {
              "messageId": "ChooseSize"
            }
          },
          "InvalidSize": {
            "transitions": [
              {
                "target": "state:ChooseSize"
              }
            ],
            "meta": {
              "messageId": "InvalidSize",
              "transient": true
            }
          }
        },
        "meta": {
          "name": "Order Coffee Flow",
          "description": "Flow for ordering a single coffee item",
          "version": "1.0.0"
        }
      }
    },
    "meta": {
      "name": "Coffee Shop Agent",
      "description": "Conversational agent for coffee shop ordering",
      "version": "1.0.0"
    }
  },
  "messages": {
    "Welcome": {
      "type": "richCard",
      "title": "Welcome to Quick Coffee!",
      "description": "Get your favorite coffee ready for pickup in minutes!",
      "size": "large",
      "suggestions": [
        {
          "type": "reply",
          "text": "Start Order"
        },
        {
          "type": "reply",
          "text": "View Menu"
        },
        {
          "type": "reply",
          "text": "Store Hours"
        }
      ]
    },
    "ShowMenu": {
      "type": "carousel",
      "title": "Our Coffee Menu",
      "size": "medium",
      "cards": [
        {
          "title": "Espresso",
          "description": "Rich, bold shot of coffee"
        },
        {
          "title": "Cappuccino",
          "description": "Espresso with steamed milk foam"
        },
        {
          "title": "Latte",
          "description": "Espresso with steamed milk"
        },
        {
          "title": "Americano",
          "description": "Espresso with hot water"
        }
      ],
      "suggestions": [
        {
          "type": "reply",
          "text": "Start Order"
        },
        {
          "type": "reply",
          "text": "Back"
        }
      ]
    },
    "StoreInfo": {
      "type": "text",
      "text": "We're open Monday-Friday 6am-7pm, weekends 7am-6pm.",
      "suggestions": [
        {
          "type": "reply",
          "text": "Start Order"
        },
        {
          "type": "reply",
          "text": "Back"
        }
      ]
    },
    "Menu": {
      "type": "text",
      "text": "What would you like to add to your order?",
      "suggestions": [
        {
          "type": "reply",
          "text": "Order Coffee"
        },
        {
          "type": "reply",
          "text": "Review Order"
        },
        {
          "type": "reply",
          "text": "Cancel Order"
        }
      ]
    },
    "OrderError": {
      "type": "text",
      "text": "Sorry, there was an error processing your order. Please try again.",
      "suggestions": [
        {
          "type": "reply",
          "text": "Try Again"
        },
        {
          "type": "reply",
          "text": "Contact Support"
        }
      ]
    },
    "ShowSupport": {
      "type": "text",
      "text": "Contact us at support@quickcoffee.com or call +1-555-0199",
      "suggestions": [
        {
          "type": "reply",
          "text": "Back"
        }
      ]
    },
    "ConfirmAllOrders": {
      "type": "richCard",
      "title": "Confirm Your Orders",
      "description": "Review and confirm your orders for checkout",
      "size": "medium",
      "suggestions": [
        {
          "type": "reply",
          "text": "Add Another Order"
        },
        {
          "type": "reply",
          "text": "Confirm All Orders"
        },
        {
          "type": "reply",
          "text": "Cancel All Orders"
        }
      ]
    },
    "ConfirmOrder": {
      "type": "richCard",
      "title": "Confirm This Order",
      "description": "Review and confirm this order",
      "size": "medium",
      "suggestions": [
        {
          "type": "reply",
          "text": "Yes, Confirm"
        },
        {
          "type": "reply",
          "text": "No, Go Back"
        },
        {
          "type": "reply",
          "text": "Cancel Order"
        }
      ]
    },
    "ChooseDrink": {
      "type": "text",
      "text": "What type of coffee would you like?",
      "suggestions": [
        {
          "type": "reply",
          "text": "Espresso"
        },
        {
          "type": "reply",
          "text": "Cappuccino"
        },
        {
          "type": "reply",
          "text": "Latte"
        },
        {
          "type": "reply",
          "text": "Americano"
        }
      ]
    },
    "InvalidDrink": {
      "type": "text",
      "text": "Please choose from our available drinks.",
      "suggestions": [
        {
          "type": "reply",
          "text": "Espresso"
        },
        {
          "type": "reply",
          "text": "Cappuccino"
        },
        {
          "type": "reply",
          "text": "Latte"
        },
        {
          "type": "reply",
          "text": "Americano"
        }
      ]
    },
    "Customize": {
      "type": "text",
      "text": "How would you like your milk?",
      "suggestions": [
        {
          "type": "reply",
          "text": "Regular"
        },
        {
          "type": "reply",
          "text": "Skim"
        },
        {
          "type": "reply",
          "text": "Soy +$0.60"
        },
        {
          "type": "reply",
          "text": "Oat +$0.60"
        },
        {
          "type": "reply",
          "text": "No Milk"
        }
      ]
    },
    "InvalidMilk": {
      "type": "text",
      "text": "Please choose a valid milk option.",
      "suggestions": [
        {
          "type": "reply",
          "text": "Regular"
        },
        {
          "type": "reply",
          "text": "Skim"
        },
        {
          "type": "reply",
          "text": "Soy +$0.60"
        },
        {
          "type": "reply",
          "text": "Oat +$0.60"
        },
        {
          "type": "reply",
          "text": "No Milk"
        }
      ]
    },
    "ChooseSize": {
      "type": "text",
      "text": "What size would you like?",
      "suggestions": [
        {
          "type": "reply",
          "text": "Small $3.50"
        },
        {
          "type": "reply",
          "text": "Medium $4.50"
        },
        {
          "type": "reply",
          "text": "Large $5.50"
        }
      ]
    },
    "InvalidSize": {
      "type": "text",
      "text": "Please choose a valid size.",
      "suggestions": [
        {
          "type": "reply",
          "text": "Small $3.50"
        },
        {
          "type": "reply",
          "text": "Medium $4.50"
        },
        {
          "type": "reply",
          "text": "Large $5.50"
        }
      ]
    },
    "ReviewOrder": {
      "type": "richCard",
      "title": "Review Your Order",
      "description": "Review the items in your current order",
      "size": "medium",
      "suggestions": [
        {
          "type": "reply",
          "text": "Add Another Coffee"
        },
        {
          "type": "reply",
          "text": "Remove Last Item"
        },
        {
          "type": "reply",
          "text": "Confirm Order"
        },
        {
          "type": "reply",
          "text": "Cancel Order"
        }
      ]
    },
    "ProcessPayment": {
      "type": "text",
      "text": "Processing your payment..."
    },
    "OrderComplete": {
      "type": "richCard",
      "title": "Orders Confirmed!",
      "description": "Your orders will be ready for pickup in 5-7 minutes. Show this confirmation at the counter.",
      "size": "large"
    },
    "ThankYou": {
      "type": "text",
      "text": "Thank you for your orders! Your pickup time will be provided shortly. Show this confirmation at the counter.",
      "suggestions": [
        {
          "type": "reply",
          "text": "Start New Order"
        },
        {
          "type": "reply",
          "text": "View Receipt"
        }
      ]
    },
    "ShowReceipt": {
      "type": "richCard",
      "title": "Your Receipt",
      "description": "Order Summary and total",
      "size": "medium",
      "suggestions": [
        {
          "type": "reply",
          "text": "Start New Order"
        },
        {
          "type": "reply",
          "text": "Back"
        }
      ]
    }
  }
}